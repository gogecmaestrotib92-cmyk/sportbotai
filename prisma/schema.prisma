generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id                     String          @id @default(cuid())
  name                   String?
  email                  String?         @unique
  emailVerified          DateTime?
  image                  String?
  password               String?
  plan                   Plan            @default(FREE)
  stripeCustomerId       String?         @unique
  stripeSubscriptionId   String?         @unique
  stripePriceId          String?
  stripeCurrentPeriodEnd DateTime?
  analysisCount          Int             @default(0)
  lastAnalysisDate       DateTime?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  referralCampaign       String?
  referralMedium         String?
  referralSource         String?
  bannedReason           String?
  bonusCredits           Int             @default(0)
  isBanned               Boolean         @default(false)
  lastActiveAt           DateTime?
  chatCount              Int             @default(0)
  lastChatDate           DateTime?
  paymentProvider        String?
  paypalCurrentPeriodEnd DateTime?
  paypalPlanId           String?
  paypalSubscriptionId   String?         @unique
  registrationIp         String?
  unsubscribedAt         DateTime?
  accounts               Account[]
  analyses               Analysis[]
  chatQueries            ChatQuery[]
  chatSessions           ChatSession[]
  favoriteTeams          FavoriteTeam[]
  sessions               Session[]
  preference             UserPreference?
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Analysis {
  id            String      @id @default(cuid())
  userId        String
  sport         String
  league        String
  homeTeam      String
  awayTeam      String
  matchDate     DateTime?
  userPick      String?
  userStake     Float?
  homeWinProb   Float?
  drawProb      Float?
  awayWinProb   Float?
  riskLevel     String?
  bestValueSide String?
  fullResponse  Json?
  createdAt     DateTime    @default(now())
  actualScore   String?
  outcome       CallOutcome @default(PENDING)
  validatedAt   DateTime?
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([outcome])
}

model BlogKeyword {
  id              String        @id @default(cuid())
  keyword         String        @unique
  status          KeywordStatus @default(PENDING)
  lastGeneratedAt DateTime?
  generationCount Int           @default(0)
  searchVolume    Int?
  difficulty      Int?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  posts           BlogPost[]

  @@index([status])
  @@index([lastGeneratedAt])
}

model BlogPost {
  id                 String       @id @default(cuid())
  title              String
  slug               String       @unique
  excerpt            String
  content            String
  metaTitle          String?
  metaDescription    String?
  focusKeyword       String?
  featuredImage      String?
  imageAlt           String?
  category           String?
  tags               String[]
  status             PostStatus   @default(DRAFT)
  publishedAt        DateTime?
  keywordId          String?
  aiModel            String?
  generationCost     Float?
  views              Int          @default(0)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  awayTeam           String?
  finalScore         String?
  homeTeam           String?
  league             String?
  matchDate          DateTime?
  matchId            String?
  postMatchContent   String?
  postMatchUpdatedAt DateTime?
  postType           PostType     @default(GENERAL)
  sport              String?
  newsContent        String?
  newsTitle          String?
  contentSr          String?
  excerptSr          String?
  metaDescriptionSr  String?
  metaTitleSr        String?
  newsContentSr      String?
  newsTitleSr        String?
  slugSr             String?
  titleSr            String?
  translatedAt       DateTime?
  keyword            BlogKeyword? @relation(fields: [keywordId], references: [id])

  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([keywordId])
  @@index([matchId])
  @@index([matchDate])
  @@index([postType])
  @@index([translatedAt])
}

model FavoriteTeam {
  id             String   @id @default(cuid())
  userId         String
  teamName       String
  teamSlug       String
  sport          String
  league         String?
  sportKey       String?
  teamLogo       String?
  country        String?
  notifyMatches  Boolean  @default(true)
  notifyInjuries Boolean  @default(false)
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, teamSlug, sport])
  @@index([userId])
  @@index([teamSlug])
  @@index([sport])
}

model ChatQuery {
  id                  String    @id @default(cuid())
  query               String
  queryNormalized     String?
  category            String?
  brainMode           String?
  sport               String?
  team                String?
  league              String?
  usedRealTimeSearch  Boolean   @default(false)
  responseLength      Int?
  hadCitations        Boolean   @default(false)
  queryHash           String?
  similarCount        Int       @default(1)
  createdAt           DateTime  @default(now())
  answer              String?
  citations           Json?
  expiresAt           DateTime?
  userId              String?
  dataConfidenceLevel String?
  dataConfidenceScore Int?
  dataSources         Json?
  cacheHit            Boolean   @default(false)
  detectedIntent      String?
  entitiesDetected    Json?
  entityMismatch      Boolean   @default(false)
  expandedQuery       String?
  feedbackAt          DateTime?
  feedbackComment     String?
  feedbackRating      Int?
  intentConfidence    Float?
  latencyMs           Int?
  mismatchDetails     String?
  patternMatched      String?
  responseSource      String?
  wasLLMClassified    Boolean   @default(false)
  abTestId            String?
  abTestVariant       String?
  user                User?     @relation(fields: [userId], references: [id])

  @@index([category])
  @@index([sport])
  @@index([team])
  @@index([queryHash])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([userId])
  @@index([dataConfidenceLevel])
  @@index([detectedIntent])
  @@index([feedbackRating])
  @@index([entityMismatch])
  @@index([wasLLMClassified])
}

model TrendingTopic {
  id              String    @id @default(cuid())
  topic           String    @unique
  category        String?
  sport           String?
  queryCount      Int       @default(1)
  last24hCount    Int       @default(0)
  last7dCount     Int       @default(0)
  isSpike         Boolean   @default(false)
  spikeDetectedAt DateTime?
  lastFetchedAt   DateTime?
  cachedResponse  String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([queryCount])
  @@index([last24hCount])
  @@index([sport])
  @@index([isSpike])
}

model ChatFeedback {
  id                  String   @id @default(cuid())
  messageId           String
  queryHash           String
  query               String
  response            String
  rating              Int
  feedback            String?
  sport               String?
  category            String?
  brainMode           String?
  usedRealTimeSearch  Boolean  @default(false)
  fromCache           Boolean  @default(false)
  userId              String?
  userPlan            String?
  createdAt           DateTime @default(now())
  dataConfidenceLevel String?
  dataConfidenceScore Int?

  @@index([messageId])
  @@index([queryHash])
  @@index([rating])
  @@index([userId])
  @@index([createdAt])
  @@index([dataConfidenceLevel])
}

model AgentPost {
  id             String   @id @default(cuid())
  content        String
  category       String
  homeTeam       String?
  awayTeam       String?
  matchRef       String?
  league         String?
  sport          String?
  narrativeAngle String?
  publicMismatch String?
  clarityLevel   Int?
  confidence     Int?
  severity       Int?
  realTimeData   Boolean  @default(false)
  citations      String[]
  postedToX      Boolean  @default(false)
  xPostId        String?
  impressions    Int      @default(0)
  engagement     Int      @default(0)
  createdAt      DateTime @default(now())
  predictionId   String?

  @@index([category])
  @@index([homeTeam])
  @@index([awayTeam])
  @@index([createdAt])
  @@index([postedToX])
  @@index([predictionId])
}

model KnowledgeBase {
  id              String   @id @default(cuid())
  question        String
  answer          String
  sport           String?
  category        String?
  team            String?
  quality         Int      @default(3)
  useCount        Int      @default(1)
  citations       String[]
  hadRealTimeData Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sport])
  @@index([category])
  @@index([team])
  @@index([quality])
  @@index([useCount])
}

model SportExpertise {
  id              String   @id @default(cuid())
  sport           String   @unique
  topCategories   String[]
  commonQuestions String[]
  keyTerminology  String[]
  learnedFacts    String[]
  totalQueries    Int      @default(0)
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sport])
}

model Prediction {
  id                     String           @id @default(cuid())
  matchId                String
  matchName              String
  sport                  String
  league                 String
  kickoff                DateTime
  type                   CallType
  prediction             String
  reasoning              String
  conviction             Int
  odds                   Float?
  impliedProb            Float?
  tweetId                String?
  validationTweetId      String?
  outcome                CallOutcome      @default(PENDING)
  actualResult           String?
  validatedAt            DateTime?
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  actualScore            String?
  source                 PredictionSource @default(PRE_ANALYZE)
  closingOdds            Float?
  clvFetched             Boolean          @default(false)
  clvPercentage          Float?
  openingOdds            Float?
  valueBetEdge           Float?
  valueBetOdds           Float?
  valueBetOutcome        CallOutcome?
  valueBetProfit         Float?
  valueBetSide           String?
  modelVersion           String           @default("v2")
  binaryOutcome          Int?
  closingProbabilityFair Float?
  clvValue               Float?
  edgeBucket             EdgeBucket?
  edgeValue              Float?
  marketOddsAtPrediction Float?
  marketProbabilityFair  Float?
  marketProbabilityRaw   Float?
  marketType             MarketType?
  modelProbability       Float?
  predictionTimestamp    DateTime?
  resultTimestamp        DateTime?
  selection              String?
  awayWin                Float?
  draw                   Float?
  headline               String?
  homeWin                Float?
  predictedScore         String?
  signals                String?
  fullResponse           Json?

  @@index([matchId])
  @@index([outcome])
  @@index([sport])
  @@index([league])
  @@index([source])
  @@index([createdAt])
  @@index([conviction])
  @@index([clvFetched])
  @@index([valueBetOutcome])
  @@index([modelVersion])
  @@index([edgeBucket])
  @@index([binaryOutcome])
  @@index([marketType])
}

model ScheduledPost {
  id           String       @id @default(cuid())
  content      String
  contentType  PostCategory
  scheduledFor DateTime
  timezone     String       @default("UTC")
  matchId      String?
  predictionId String?
  posted       Boolean      @default(false)
  postedAt     DateTime?
  tweetId      String?
  error        String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([scheduledFor])
  @@index([posted])
  @@index([contentType])
}

model TwitterPost {
  id             String       @id @default(cuid())
  tweetId        String       @unique
  content        String
  category       PostCategory
  threadId       String?
  threadPosition Int?
  likes          Int          @default(0)
  retweets       Int          @default(0)
  replies        Int          @default(0)
  impressions    Int          @default(0)
  postedAt       DateTime     @default(now())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([category])
  @@index([postedAt])
  @@index([threadId])
}

model DailyStats {
  id               String   @id @default(cuid())
  date             DateTime @unique @db.Date
  totalPredictions Int      @default(0)
  hits             Int      @default(0)
  misses           Int      @default(0)
  pushes           Int      @default(0)
  hitRate          Float    @default(0)
  conv1Hits        Int      @default(0)
  conv1Total       Int      @default(0)
  conv2Hits        Int      @default(0)
  conv2Total       Int      @default(0)
  conv3Hits        Int      @default(0)
  conv3Total       Int      @default(0)
  conv4Hits        Int      @default(0)
  conv4Total       Int      @default(0)
  conv5Hits        Int      @default(0)
  conv5Total       Int      @default(0)
  postsCount       Int      @default(0)
  totalLikes       Int      @default(0)
  totalRetweets    Int      @default(0)
  totalImpressions Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([date])
}

model OddsSnapshot {
  id              String   @id @default(cuid())
  matchRef        String
  sport           String
  league          String
  homeTeam        String
  awayTeam        String
  matchDate       DateTime
  homeOdds        Float
  awayOdds        Float
  drawOdds        Float?
  prevHomeOdds    Float?
  prevAwayOdds    Float?
  prevDrawOdds    Float?
  homeChange      Float?
  awayChange      Float?
  drawChange      Float?
  modelHomeProb   Float?
  modelAwayProb   Float?
  modelDrawProb   Float?
  homeEdge        Float?
  awayEdge        Float?
  drawEdge        Float?
  hasSteamMove    Boolean  @default(false)
  hasValueEdge    Boolean  @default(false)
  alertLevel      String?
  alertNote       String?
  bookmaker       String?  @default("consensus")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  openingAwayOdds Float?
  openingDrawOdds Float?
  openingHomeOdds Float?

  @@unique([matchRef, sport, bookmaker])
  @@index([sport])
  @@index([matchDate])
  @@index([hasSteamMove])
  @@index([hasValueEdge])
  @@index([matchRef])
}

model ShareLink {
  id         String    @id @default(cuid())
  code       String    @unique
  homeTeam   String
  awayTeam   String
  league     String    @default("Match")
  verdict    String    @default("AI Analysis")
  risk       String    @default("MEDIUM")
  confidence Int       @default(75)
  value      String?
  matchDate  String?
  sport      String    @default("soccer")
  views      Int       @default(0)
  createdAt  DateTime  @default(now())
  expiresAt  DateTime?

  @@index([code])
  @@index([createdAt])
}

model EdgeTracking {
  id             String      @id @default(cuid())
  predictionId   String
  matchId        String
  sport          String
  league         String
  kickoff        DateTime
  ourModelHome   Float
  ourModelAway   Float
  ourModelDraw   Float?
  marketHome     Float
  marketAway     Float
  marketDraw     Float?
  ensembleMethod String      @default("default")
  finalHome      Float
  finalAway      Float
  finalDraw      Float?
  edgeSide       String
  edgeValue      Float
  conviction     Int
  situationalAdj Float       @default(0)
  trapGameFlag   Boolean     @default(false)
  outcome        CallOutcome @default(PENDING)
  actualResult   String?
  clvPercentage  Float?
  beatingMarket  Boolean?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@index([sport])
  @@index([ensembleMethod])
  @@index([outcome])
  @@index([createdAt])
}

model LineMovement {
  id           String    @id @default(cuid())
  matchId      String    @unique
  matchName    String
  sport        String
  league       String
  kickoff      DateTime
  openingHome  Float
  openingAway  Float
  openingDraw  Float?
  openingTime  DateTime
  currentHome  Float
  currentAway  Float
  currentDraw  Float?
  updatedTime  DateTime
  homeMovement Float
  awayMovement Float
  drawMovement Float?
  isSharpMove  Boolean   @default(false)
  sharpSide    String?
  alertSent    Boolean   @default(false)
  alertSentAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([sport])
  @@index([kickoff])
  @@index([isSharpMove])
  @@index([alertSent])
}

model ToolReview {
  id                String         @id @default(cuid())
  toolName          String
  toolUrl           String         @unique
  toolDescription   String?
  toolLogo          String?
  scrapedFrom       String
  sourceUrl         String?
  scrapedAt         DateTime       @default(now())
  contentExtracted  String?
  contentWords      Int            @default(0)
  contactEmail      String?
  contactName       String?
  emailSource       String?
  reviewStatus      ReviewStatus   @default(PENDING)
  blogPostId        String?        @unique
  blogSlug          String?
  reviewTitle       String?
  reviewContent     String?
  reviewGeneratedAt DateTime?
  outreachStatus    OutreachStatus @default(NOT_SENT)
  outreachSentAt    DateTime?
  outreachEmailId   String?
  outreachOpened    Boolean        @default(false)
  outreachClicked   Boolean        @default(false)
  outreachReplied   Boolean        @default(false)
  outreachReplyAt   DateTime?
  backlinkStatus    BacklinkStatus @default(NONE)
  backlinkUrl       String?
  backlinkCheckedAt DateTime?
  dofollow          Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@index([scrapedFrom])
  @@index([reviewStatus])
  @@index([outreachStatus])
  @@index([backlinkStatus])
  @@index([scrapedAt])
}

model EmailCampaign {
  id              String         @id @default(cuid())
  type            CampaignType
  subject         String
  userId          String
  userEmail       String
  userName        String?
  matchesData     Json?
  status          OutreachStatus @default(SENT)
  sentAt          DateTime       @default(now())
  openedAt        DateTime?
  clickedAt       DateTime?
  unsubscribedAt  DateTime?
  convertedToPaid Boolean        @default(false)
  convertedAt     DateTime?
  createdAt       DateTime       @default(now())

  @@index([userId])
  @@index([userEmail])
  @@index([type])
  @@index([status])
  @@index([sentAt])
}

model TwitterEngagement {
  id                   String         @id @default(cuid())
  type                 EngagementType
  targetTweetId        String
  targetAuthorId       String
  targetAuthorUsername String?
  targetText           String?
  replyTweetId         String?
  replyText            String?
  createdAt            DateTime       @default(now())

  @@index([targetAuthorId])
  @@index([targetTweetId])
  @@index([type])
  @@index([createdAt])
}

model ChatSession {
  id            String        @id @default(cuid())
  userId        String
  title         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  lastMessageAt DateTime      @default(now())
  messageCount  Int           @default(0)
  messages      ChatMessage[]
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lastMessageAt])
}

model ChatMessage {
  id         String      @id @default(cuid())
  sessionId  String
  role       String
  content    String
  createdAt  DateTime    @default(now())
  teams      String[]
  players    String[]
  sport      String?
  intent     String?
  feedback   Int?
  feedbackAt DateTime?
  session    ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([createdAt])
}

model UserPreference {
  id               String   @id @default(cuid())
  userId           String   @unique
  preferredSports  String[]
  preferredLeagues String[]
  analysisStyle    String?
  bettingStyle     String?
  totalQueries     Int      @default(0)
  avgFeedbackScore Float?
  mostAskedTeams   String[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model LearnedResponse {
  id            String   @id @default(cuid())
  queryPattern  String
  queryHash     String   @unique
  response      String
  feedbackScore Float    @default(0)
  useCount      Int      @default(0)
  lastUsedAt    DateTime @default(now())
  sport         String?
  intent        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([queryHash])
  @@index([sport])
  @@index([feedbackScore])
}

model DailyPicksCache {
  id          String   @id @default(cuid())
  date        String   @unique
  pickIds     String[]
  generatedAt DateTime @default(now())

  @@index([date])
}

enum EdgeBucket {
  NO_EDGE
  SMALL
  MEDIUM
  HIGH
}

enum MarketType {
  MONEYLINE
  SPREAD
  TOTALS
}

enum Plan {
  FREE
  PRO
  PREMIUM
  ADMIN
}

enum KeywordStatus {
  PENDING
  ACTIVE
  EXHAUSTED
  DISABLED
}

enum PostStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
}

enum PostType {
  GENERAL
  MATCH_PREVIEW
  MATCH_RECAP
  MATCH_COMBINED
  NEWS
}

enum CallType {
  MATCH_RESULT
  OVER_UNDER
  BTTS
  PLAYER_PROP
  FIRST_SCORER
  CLEAN_SHEET
  CORNER_COUNT
  CARD_COUNT
  HANDICAP
  DOUBLE_CHANCE
}

enum CallOutcome {
  PENDING
  HIT
  MISS
  PUSH
  VOID
  EXPIRED
}

enum PredictionSource {
  PRE_ANALYZE
  MATCH_ANALYSIS
  AGENT_POST
}

enum PostCategory {
  MORNING_BRIEFING
  MATCH_PREVIEW
  LIVE_UPDATE
  POST_MATCH
  CALL_VALIDATION
  HOT_TAKE
  TRENDING
  WEEKLY_STATS
  THREAD
  LIVE_INTEL
}

enum ReviewStatus {
  PENDING
  SKIP
  GENERATING
  GENERATED
  PUBLISHED
  FAILED
}

enum OutreachStatus {
  NOT_SENT
  NO_EMAIL
  QUEUED
  SENT
  OPENED
  CLICKED
  REPLIED
  BOUNCED
}

enum BacklinkStatus {
  NONE
  PENDING
  NOFOLLOW
  DOFOLLOW
  REMOVED
}

enum CampaignType {
  DAILY_PICKS
  WEEKLY_DIGEST
  WIN_STREAK
  RE_ENGAGEMENT
  UPGRADE_NUDGE
}

enum EngagementType {
  MENTION_REPLY
  ACCOUNT_REPLY
  QUOTE_TWEET
}

// ============================================
// AFFILIATE PROGRAM
// ============================================

model Affiliate {
  id              String               @id @default(cuid())
  email           String               @unique
  password        String               // Hashed password for affiliate login
  name            String
  code            String               @unique // Unique referral code (e.g., "john123")
  status          AffiliateStatus      @default(PENDING)
  paypalEmail     String?              // For payouts
  website         String?              // Their website/social
  notes           String?              // Internal notes
  commissionRate  Float                @default(0.30) // 30% default
  cookieDays      Int                  @default(90)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  approvedAt      DateTime?
  clicks          AffiliateClick[]
  conversions     AffiliateConversion[]
  payouts         AffiliatePayout[]

  @@index([code])
  @@index([email])
}

model AffiliateClick {
  id          String    @id @default(cuid())
  affiliateId String
  affiliate   Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  ipHash      String?   // Hashed IP for uniqueness (privacy)
  userAgent   String?
  referer     String?   // Where they came from
  landingPage String?   // Which page they landed on
  createdAt   DateTime  @default(now())
  convertedAt DateTime? // When/if they converted

  @@index([affiliateId])
  @@index([createdAt])
}

model AffiliateConversion {
  id                   String          @id @default(cuid())
  affiliateId          String
  affiliate            Affiliate       @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  userId               String?         // The user who subscribed (optional link)
  stripeSubscriptionId String?         @unique
  planName             String          // "Pro Monthly", "Premium Yearly", etc.
  amount               Float           // Subscription amount in USD
  commission           Float           // Commission amount in USD
  status               ConversionStatus @default(PENDING)
  createdAt            DateTime        @default(now())
  paidAt               DateTime?       // When commission was paid
  payoutId             String?
  payout               AffiliatePayout? @relation(fields: [payoutId], references: [id])

  @@index([affiliateId])
  @@index([status])
  @@index([createdAt])
}

model AffiliatePayout {
  id          String               @id @default(cuid())
  affiliateId String
  affiliate   Affiliate            @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  amount      Float                // Total payout amount
  method      String               @default("paypal") // paypal, wire, crypto
  reference   String?              // PayPal transaction ID, etc.
  status      PayoutStatus         @default(PENDING)
  createdAt   DateTime             @default(now())
  paidAt      DateTime?
  conversions AffiliateConversion[]

  @@index([affiliateId])
  @@index([status])
}

enum AffiliateStatus {
  PENDING    // Applied, waiting approval
  ACTIVE     // Approved and active
  SUSPENDED  // Temporarily suspended
  REJECTED   // Application rejected
}

enum ConversionStatus {
  PENDING    // Waiting for subscription confirmation
  APPROVED   // Confirmed, waiting for payout
  PAID       // Commission paid out
  REFUNDED   // Subscription was refunded
  CANCELLED  // Subscription cancelled before payout
}

enum PayoutStatus {
  PENDING    // Scheduled for payout
  PROCESSING // Being processed
  COMPLETED  // Successfully paid
  FAILED     // Payout failed
}
